name: stage-contracts
note: >2-
    - Record: struct { Locator string; Meta map[string]any }
    - FileInfo: struct { Path, RelPath, Dir, Base, Name, Ext string } + optional { Size int64; Mode os.FileMode; Mod time.Time; IsDir bool } when files.info=true
    - GitInfo (file.git when files.git=true): struct { Tracked bool; Ignored bool; LastCommitSha string; LastAuthorName string; LastAuthorEmail string; LastCommitTime time.Time }
    - ShellResult: struct { Cmd []string; ExitCode int; Stdout []byte; Stderr []byte; Duration time.Duration }
    - JSONPatch: []PatchOp (RFC6902)
    - MetaOut: struct { Meta map[string]any }
    - UpdateOut: struct { Meta map[string]any; Patch JSONPatch } (one of)
    - 
    - MetaFilter: func(Record) (bool, error)
    - MetaMap: func(Record) (any, error)
    - MetaPostShell: func(Record, ShellResult) (any, error)
    - MetaReduce: func(acc any, value any) (any, error)
    - 
    - FilesFilter: func(FileInfo) (bool, error)
    - FilesMap: func(FileInfo) (any, error)
    - FilesPostMap: func(FileInfo, input any) (MetaOut, error)
    - FilesPostUpdate: func(FileInfo, input any, existing *Record) (UpdateOut, error)
labels:
  - design
